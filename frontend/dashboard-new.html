<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>דשבורד ניהול משימות - משרד עו"ד GH</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/dashboard-secretary-style.css?v=2">
</head>
<body>
  <!-- ניווט עליון -->
  <header class="app-header">
    <div class="app-logo">
      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDQwIDQwIiBmaWxsPSJub25lIj48cGF0aCBkPSJNMjAgMEM4Ljk1IDAgMCA4Ljk1IDAgMjBDMCAzMS4wNSA4Ljk1IDQwIDIwIDQwQzMxLjA1IDQwIDQwIDMxLjA1IDQwIDIwQzQwIDguOTUgMzEuMDUgMCAyMCAwWiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzEzNF8xNzIpIi8+PHBhdGggZD0iTTExIDE1TDIwIDI0TDI5IDE1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PHBhdGggZD0iTTExIDI0TDIwIDMzTDI5IDI0IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzEzNF8xNzIiIHgxPSI0MCIgeTE9IjIwIiB4Mj0iMCIgeTI9IjIwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agc3RvcC1jb2xvcj0iIzI5NzlGRiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzAwNDlEQiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjwvc3ZnPg==" alt="Logo">
      <span>משרד עו"ד GH</span>
    </div>

    <div class="user-menu" id="userMenu">
      <div class="user-avatar" id="userAvatar">?</div>
      <div class="user-info">
        <div class="user-name" id="currentUserName">משתמש</div>
        <div class="user-role">מזכירה</div>
      </div>
      <div class="user-menu-dropdown" id="userMenuDropdown">
        <div class="dropdown-item" id="switchUserBtn">
          <i class="fas fa-exchange-alt"></i>
          <span>החלף משתמש</span>
        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item" id="newTaskMenuItem">
          <i class="fas fa-plus-circle"></i>
          <span>משימה חדשה</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Header Section with Stats and Actions -->
    <div class="dashboard-header">
      <div class="dashboard-header-content">
        <h1 class="dashboard-title" id="dashboardTitle">דשבורד ניהול משימות</h1>
        <p class="dashboard-subtitle" id="dashboardSubtitle">ניהול משימות יומיומי</p>
      </div>
      <div class="dashboard-actions">
        <button class="btn btn-secondary" id="refreshBtn">
          <i class="fas fa-sync-alt"></i>
          <span>רענן</span>
        </button>
        <button class="btn btn-primary" id="newTaskBtn">
          <i class="fas fa-plus"></i>
          <span>משימה חדשה</span>
        </button>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card stat-total">
        <div class="stat-icon">
          <i class="fas fa-tasks"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value" id="totalTasks">0</div>
          <div class="stat-label">סך הכל</div>
        </div>
      </div>

      <div class="stat-card stat-new">
        <div class="stat-icon">
          <i class="fas fa-inbox"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value" id="newTasks">0</div>
          <div class="stat-label">חדשות</div>
        </div>
      </div>

      <div class="stat-card stat-progress">
        <div class="stat-icon">
          <i class="fas fa-spinner"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value" id="inProgressTasks">0</div>
          <div class="stat-label">בטיפול</div>
        </div>
      </div>

      <div class="stat-card stat-completed">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">הושלמו</div>
        </div>
      </div>
    </div>

    <!-- Main Content: Sidebar + List -->
    <div class="content-layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-section-title">תצוגות</div>
          <div class="sidebar-item active" data-filter="all">
            <i class="fas fa-inbox"></i>
            <span>כל המשימות</span>
            <span class="sidebar-badge" id="allCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="starred">
            <i class="fas fa-star"></i>
            <span>מסומנות</span>
            <span class="sidebar-badge" id="starredCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="today">
            <i class="fas fa-calendar-day"></i>
            <span>היום</span>
            <span class="sidebar-badge" id="todayCount">0</span>
          </div>
        </div>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">לפי סטטוס</div>
          <div class="sidebar-item" data-filter="status:חדשה">
            <i class="fas fa-circle status-dot-new"></i>
            <span>חדשה</span>
            <span class="sidebar-badge" id="statusNewCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="status:בטיפול">
            <i class="fas fa-circle status-dot-progress"></i>
            <span>בטיפול</span>
            <span class="sidebar-badge" id="statusProgressCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="status:ממתין">
            <i class="fas fa-circle status-dot-waiting"></i>
            <span>ממתין</span>
            <span class="sidebar-badge" id="statusWaitingCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="status:הושלמה">
            <i class="fas fa-circle status-dot-completed"></i>
            <span>הושלמה</span>
            <span class="sidebar-badge" id="statusCompletedCount">0</span>
          </div>
        </div>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">לפי עדיפות</div>
          <div class="sidebar-item" data-filter="priority:דחופה">
            <i class="fas fa-exclamation-circle priority-urgent"></i>
            <span>דחופה</span>
            <span class="sidebar-badge" id="priorityUrgentCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="priority:גבוהה">
            <i class="fas fa-exclamation-circle priority-high"></i>
            <span>גבוהה</span>
            <span class="sidebar-badge" id="priorityHighCount">0</span>
          </div>
          <div class="sidebar-item" data-filter="priority:רגילה">
            <i class="fas fa-minus-circle priority-normal"></i>
            <span>רגילה</span>
            <span class="sidebar-badge" id="priorityNormalCount">0</span>
          </div>
        </div>
      </aside>

      <!-- Main List Area -->
      <main class="main-content">
        <!-- Search and Filters -->
        <div class="list-header">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="חפש משימות..." class="search-input">
          </div>
          <div class="list-filters">
            <select id="categoryFilter" class="filter-select">
              <option value="all">כל הקטגוריות</option>
              <option value="משפטית">משפטית</option>
              <option value="טכנית">טכנית</option>
              <option value="מינהלית">מינהלית</option>
              <option value="פיננסית">פיננסית</option>
            </select>
            <select id="sortBy" class="filter-select">
              <option value="date-desc">תאריך (חדש לישן)</option>
              <option value="date-asc">תאריך (ישן לחדש)</option>
              <option value="priority">עדיפות</option>
              <option value="assignee">אחראי</option>
            </select>
          </div>
        </div>

        <!-- Current Filter Title -->
        <div class="list-title-section">
          <h2 class="list-title" id="currentFilterTitle">כל המשימות</h2>
          <div class="list-count" id="listCount">0 משימות</div>
        </div>

        <!-- Tasks List -->
        <div class="tasks-list" id="tasksList">
          <!-- Loading State -->
          <div class="list-loading" id="listLoading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>טוען משימות...</p>
          </div>

          <!-- Empty State -->
          <div class="list-empty" id="listEmpty" style="display: none;">
            <i class="fas fa-inbox"></i>
            <p>אין משימות להצגה</p>
          </div>

          <!-- Tasks will be rendered here -->
        </div>
      </main>
    </div>
  </div>

  <!-- Modal: View Task Details (User View - GitHub Style) -->
  <div class="modal-overlay" id="taskModalOverlay">
    <div class="modal modal-large">
      <div class="modal-header">
        <h3 class="modal-title">פרטי משימה</h3>
        <button class="modal-close" id="closeTaskModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div id="taskDetailsContent" class="task-detail-grid">
          <!-- Will be populated by JavaScript with GitHub Issue style -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="closeTaskModalBtn">סגור</button>
      </div>
    </div>
  </div>

  <!-- Modal: Update Task (Secretary - Side by Side) -->
  <div class="modal-overlay" id="updateTaskModalOverlay">
    <div class="modal modal-large">
      <div class="modal-header">
        <h3 class="modal-title">עדכון משימה</h3>
        <button class="modal-close" id="closeUpdateModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Side-by-Side Layout: Update Form + Task Details -->
        <div class="update-modal-grid">
          <!-- First Column (appears on right in RTL): Update Form -->
          <div class="update-modal-form">
            <form id="updateTaskForm">
              <input type="hidden" id="updateTaskId">

              <!-- Primary actions: Status and Priority -->
              <div class="form-group">
                <label class="form-label">סטטוס</label>
                <select id="updateStatus" class="form-control" required>
                  <option value="">בחר סטטוס</option>
                  <option value="ממתינה">ממתינה</option>
                  <option value="בביצוע">בביצוע</option>
                  <option value="בוצע">בוצע</option>
                  <option value="הוחזר להשלמה">הוחזר להשלמה</option>
                  <option value="בוטל">בוטל</option>
                  <option value="פג תוקף - לא רלוונטי">פג תוקף - לא רלוונטי</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">עדיפות</label>
                <select id="updatePriority" class="form-control">
                  <option value="">ללא שינוי</option>
                  <option value="דחופה">דחופה</option>
                  <option value="גבוהה">גבוהה</option>
                  <option value="רגילה">רגילה</option>
                  <option value="נמוכה">נמוכה</option>
                </select>
              </div>

              <!-- Completion details section -->
              <div id="completionDetailsGroup" style="display: none;">
                <div class="form-group">
                  <label class="form-label">
                    פרטי ביצוע
                    <span style="font-size: 11px; color: #9ca3af; font-weight: normal; margin-right: 6px;">(אופציונלי)</span>
                  </label>
                  <textarea
                    id="updateCompletionDetails"
                    class="form-control"
                    rows="2"
                    placeholder="מה בוצע? (אופציונלי)"
                  ></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                  <div class="form-group">
                    <label class="form-label">תאריך השלמה</label>
                    <input type="date" id="updateCompletionDate" class="form-control">
                  </div>
                  <div class="form-group">
                    <label class="form-label">שעת השלמה</label>
                    <input type="time" id="updateCompletionTime" class="form-control">
                  </div>
                </div>
              </div>

              <!-- Notes section -->
              <div class="form-group">
                <label class="form-label">
                  הערות
                  <span style="font-size: 11px; color: #9ca3af; font-weight: normal; margin-right: 6px;">(אופציונלי)</span>
                </label>
                <textarea
                  id="updateNotes"
                  class="form-control"
                  rows="2"
                  placeholder="הערות נוספות (אופציונלי)"
                ></textarea>
              </div>
            </form>
          </div>

          <!-- Second Column (appears on left in RTL): Task Details Preview -->
          <div class="update-modal-preview">
            <div class="update-preview-header">פרטי משימה</div>
            <div id="updateTaskPreview" class="task-detail-grid">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancelUpdateBtn">ביטול</button>
        <button type="button" class="btn btn-primary" id="saveUpdateBtn">
          <i class="fas fa-save"></i>
          שמור עדכון
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Create New Task -->
  <div class="modal-overlay" id="createTaskModal">
    <div class="modal modal-large">
      <div class="modal-header">
        <h3 class="modal-title">הוספת משימה חדשה</h3>
        <button class="modal-close" id="closeCreateModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="createTaskForm">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-tasks"></i> תיאור המשימה *
            </label>
            <textarea
              id="createTaskDescription"
              class="form-control"
              rows="4"
              placeholder="תאר את המשימה בפירוט..."
              required
            ></textarea>
            <p style="margin-top: 6px; font-size: 12px; color: #6b7280;">פרט ככל האפשר את דרישות המשימה והמטרות הנדרשות</p>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-tag"></i> סיווג משימה *
              </label>
              <select id="createTaskCategory" class="form-control" required>
                <option value="">-- בחר סיווג --</option>
                <option value="משפטית">משפטית</option>
                <option value="טכנית">טכנית</option>
                <option value="מינהלית">מינהלית</option>
                <option value="פיננסית">פיננסית</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calendar-alt"></i> תאריך יעד *
              </label>
              <input
                type="date"
                id="createTaskDueDate"
                class="form-control"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-flag"></i> דחיפות המשימה *
            </label>

            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                <input type="radio" name="createPriority" value="רגילה" checked style="margin: 0;">
                <span style="font-size: 13px; font-weight: 500;">רגילה</span>
              </label>
              <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                <input type="radio" name="createPriority" value="גבוהה" style="margin: 0;">
                <span style="font-size: 13px; font-weight: 500;">גבוהה</span>
              </label>
              <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                <input type="radio" name="createPriority" value="דחופה" style="margin: 0;">
                <span style="font-size: 13px; font-weight: 500;">דחופה</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-user"></i> מוטל על
            </label>
            <select id="createTaskAssignee" class="form-control">
              <option value="">-- בחר אחראי --</option>
              <option value="חיים">חיים</option>
              <option value="גיא">גיא</option>
              <option value="רועי">רועי</option>
              <option value="שחר">שחר</option>
              <option value="עוזי">עוזי</option>
              <option value="אורי">אורי</option>
              <option value="שני">שני</option>
              <option value="ראיד">ראיד</option>
              <option value="מרווה">מרווה</option>
              <option value="מירי">מירי</option>
              <option value="עוז">עוז</option>
              <option value="לירז">לירז</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancelCreateBtn">ביטול</button>
        <button type="button" class="btn btn-primary" id="saveCreateBtn">
          <i class="fas fa-paper-plane"></i>
          שלח משימה
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/config.js?v=2"></script>
  <script src="js/utils.js?v=2"></script>
  <script src="js/state-manager.js?v=2"></script>
  <script src="js/cache-service.js?v=2"></script>
  <script src="js/auth-service.js?v=2"></script>
  <script src="js/api-service.js?v=2"></script>
  <script>
    // Protect dashboard route (optional)
    // protectRoute(false); // Set to true to require login
  </script>
  <script src="js/dashboard-secretary.js?v=2"></script>
</body>
</html>
